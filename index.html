<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸŒ ë¯¸ë˜ ì§„ë¡œ íƒí—˜ TRPG</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Noto+Sans+KR:wght@400;500;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">

  <!-- WebChat SDK -->
  <script src="https://cdn.botframework.com/botframework-webchat/latest/webchat.js"></script>

  <style>
    /* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
       ğŸ¨ í…Œë§ˆ ìƒ‰ìƒ â€” ì—¬ê¸°ë§Œ ë°”ê¾¸ë©´ ë©ë‹ˆë‹¤!
    â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
    :root {
      --color-bg-dark:      #0a0a2e;
      --color-bg-mid:       #1a1a5e;
      --color-bg-panel:     rgba(8, 8, 38, 0.97);
      --color-accent:       #7df9ff;
      --color-accent-gold:  #ffd700;
      --color-accent-green: #2ed573;
      --color-accent-red:   #ff4757;
      --color-text-main:    #ffffff;
      --color-text-sub:     #a0a8d0;
      --color-border:       rgba(125, 249, 255, 0.25);
      --glow-accent:        0 0 20px rgba(125, 249, 255, 0.4);
      --gradient-bg:        linear-gradient(135deg, #0a0a2e 0%, #1a1a5e 50%, #0d1b3e 100%);
      --gradient-btn:       linear-gradient(135deg, #1a1a6e, #2a2a9e);
      --gradient-accent:    linear-gradient(90deg, #7df9ff, #00b4d8);
    }

    /* â”â”â” ê¸°ë³¸ ë ˆì´ì•„ì›ƒ â”â”â” */
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: var(--gradient-bg);
      height: 100vh;
      overflow: hidden;
      color: var(--color-text-main);
    }

    /* â”â”â” í—¤ë” â”â”â” */
    #game-header {
      height: 64px;
      padding: 0 28px;
      display: flex;
      align-items: center;
      gap: 16px;
      background: rgba(0, 0, 0, 0.5);
      border-bottom: 1px solid var(--color-border);
      backdrop-filter: blur(10px);
    }
    #game-header h1 {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.2rem;
      color: var(--color-accent);
      letter-spacing: 2px;
    }
    #game-header p {
      font-size: 0.82rem;
      color: var(--color-text-sub);
    }

    /* â”â”â” 2ì—´ ë©”ì¸ ë ˆì´ì•„ì›ƒ â”â”â” */
    #game-body {
      display: flex;
      height: calc(100vh - 64px);
    }

    /* â”â”â” ì±„íŒ… ì˜ì—­ â”â”â” */
    #chat-section {
      flex: 1;
      min-width: 0;
      border-right:none;
    }
    #webchat { height: 100%; }

    /* â”â”â” ëŠ¥ë ¥ì¹˜ ì‚¬ì´ë“œ íŒ¨ë„ â”â”â” */
    #stats-panel {
      display: none; 
      width: 270px;
      flex-shrink: 0;
      background: var(--color-bg-panel);
      padding: 20px 16px;
      display: flex;
      flex-direction: column;
      gap: 14px;
      overflow-y: auto;
    }
    .panel-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 0.85rem;
      color: var(--color-accent);
      letter-spacing: 2px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--color-border);
    }
    .job-badge {
      text-align: center;
      padding: 8px 12px;
      background: var(--gradient-btn);
      border: 1px solid var(--color-border);
      border-radius: 20px;
      font-size: 0.82rem;
      color: var(--color-accent);
      font-weight: 700;
    }
    .stat-label-row {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      margin-bottom: 4px;
    }
    .stat-name  { color: var(--color-text-sub); }
    .stat-value {
      font-family: 'Share Tech Mono', monospace;
      color: var(--color-accent);
    }
    .stat-bar-bg {
      height: 7px;
      background: rgba(255, 255, 255, 0.08);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 10px;
    }
    .stat-bar-fill {
      height: 100%;
      border-radius: 4px;
      background: var(--gradient-accent);
      transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 0 8px rgba(125, 249, 255, 0.4);
    }
    .panel-footer {
      margin-top: auto;
      padding-top: 12px;
      border-top: 1px solid var(--color-border);
      font-size: 0.8rem;
      color: var(--color-text-sub);
      text-align: center;
    }

    /* â”â”â” ì„ íƒì§€ ë²„íŠ¼ â”â”â” */
    .webchat__suggested-actions__button {
      background: var(--gradient-btn) !important;
      color: var(--color-accent) !important;
      border: 1px solid var(--color-accent) !important;
      border-radius: 12px !important;
      padding: 9px 16px !important;
      font-family: 'Noto Sans KR', sans-serif !important;
      font-size: 0.88rem !important;
      font-weight: 600 !important;
      transition: all 0.2s ease !important;
      margin: 4px !important;
      cursor: pointer !important;
    }
    .webchat__suggested-actions__button:hover {
      background: var(--gradient-accent) !important;
      color: #0a0a2e !important;
      transform: translateY(-2px) !important;
      box-shadow: var(--glow-accent) !important;
    }
    .webchat__suggested-actions__flow {
      padding: 10px 16px !important;
      background: rgba(10, 10, 46, 0.8) !important;
    }

    /* â”â”â” ëª¨ë°”ì¼ ë°˜ì‘í˜• â”â”â” */
    @media (max-width: 768px) {
      #game-body { flex-direction: column; }
      #stats-panel {
        width: 100%;
        height: 170px;
        flex-direction: row;
        flex-wrap: wrap;
        overflow-x: auto;
        gap: 8px;
        padding: 10px 12px;
      }
      #chat-section {
        border-right: none;
        border-bottom: 1px solid var(--color-border);
      }
      #game-header h1 { font-size: 1rem; }
      #game-header p  { display: none; }
    }
  </style>
</head>
<body>

  <!-- â”â”â” í—¤ë” â”â”â” -->
  <header id="game-header">
    <h1>ğŸŒ NEO EARTH TRPG</h1>
    <p>ì„œê¸° 2045ë…„ â€” ì¸ë¥˜ì˜ ë¯¸ë˜ë¥¼ ë‹¹ì‹ ì˜ ì†ì—</p>
  </header>

  <!-- â”â”â” ë©”ì¸ ë ˆì´ì•„ì›ƒ â”â”â” -->
  <div id="game-body">

    <!-- ì™¼ìª½: ì±„íŒ… -->
    <section id="chat-section">
      <div id="webchat"></div>
    </section>

    <!-- ì˜¤ë¥¸ìª½: ëŠ¥ë ¥ì¹˜ íŒ¨ë„ -->
    <aside id="stats-panel">
      <div class="panel-title">âš”ï¸ STATS</div>
      <div class="job-badge" id="job-display">ì§ì—… ì„ íƒ ì „</div>
      <div id="stats-list"></div>
      <div class="panel-footer">
        ğŸ¯ ì™„ë£Œ ë¯¸ì…˜: <span id="mission-count">0</span>ê°œ
      </div>
    </aside>

  </div>

  <script>
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // âš ï¸ ì—¬ê¸°ë§Œ ìˆ˜ì •! Copilot Studio í† í° ì—”ë“œí¬ì¸íŠ¸
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
 

    // â”â”â” ëŠ¥ë ¥ì¹˜ ì´ˆê¸°ê°’ â”â”â”
    let stats = {
      "ë¬¸ì œí•´ê²°ë ¥": 50, "ë…¼ë¦¬ì ì‚¬ê³ ": 50,
      "ê¸°ìˆ í™œìš©":   50, "í˜‘ì—…ëŠ¥ë ¥":   50,
      "ì°½ì˜ì„±":     50, "ì¶”ì§„ë ¥":     50
    };
    let missionCount = 0;

    // â”â”â” ëŠ¥ë ¥ì¹˜ íŒ¨ë„ ë Œë”ë§ â”â”â”
    function renderStats(changes = {}) {
      document.getElementById('stats-list').innerHTML =
        Object.entries(stats).map(([name, val]) => {
          const delta = changes[name] || 0;
          const changeTag = delta > 0
            ? `<span style="color:var(--color-accent-gold);margin-left:4px">+${delta}â–²</span>`
            : delta < 0
            ? `<span style="color:var(--color-accent-red);margin-left:4px">${delta}â–¼</span>`
            : '';
          return `
            <div>
              <div class="stat-label-row">
                <span class="stat-name">${name}</span>
                <span class="stat-value">${val}${changeTag}</span>
              </div>
              <div class="stat-bar-bg">
                <div class="stat-bar-fill" style="width:${val}%"></div>
              </div>
            </div>`;
        }).join('');
    }

    // â”â”â” ì„ íƒì§€ íŒŒì‹± â†’ ë²„íŠ¼ ë³€í™˜ ë¯¸ë“¤ì›¨ì–´ â”â”â”
    function choiceMiddleware() {
      return ({ dispatch }) => next => action => {
        if (
          action.type === 'DIRECT_LINE/INCOMING_ACTIVITY' &&
          action.payload?.activity?.from?.role === 'bot'
        ) {
          const text = action.payload.activity.text || '';

          // ëŠ¥ë ¥ì¹˜ ë³€í™” íŒŒì‹±
          const changes = {};
          const statPatterns = [
            ["ë¬¸ì œí•´ê²°ë ¥", /ë¬¸ì œí•´ê²°ë ¥[^\+]*\+(\d+)/],
            ["ë…¼ë¦¬ì ì‚¬ê³ ", /ë…¼ë¦¬ì .{0,3}ì‚¬ê³ [^\+]*\+(\d+)/],
            ["ê¸°ìˆ í™œìš©",   /ê¸°ìˆ .{0,3}í™œìš©[^\+]*\+(\d+)/],
            ["í˜‘ì—…ëŠ¥ë ¥",   /í˜‘ì—…ëŠ¥ë ¥[^\+]*\+(\d+)/],
            ["ì°½ì˜ì„±",     /ì°½ì˜ì„±[^\+]*\+(\d+)/],
            ["ì¶”ì§„ë ¥",     /ì¶”ì§„ë ¥[^\+]*\+(\d+)/],
          ];
          statPatterns.forEach(([key, regex]) => {
            const m = text.match(regex);
            if (m) {
              const d = parseInt(m[1]);
              stats[key] = Math.min(100, stats[key] + d);
              changes[key] = d;
            }
          });
          if (Object.keys(changes).length > 0) {
            missionCount++;
            document.getElementById('mission-count').textContent = missionCount;
            renderStats(changes);
          }

          // ì§ì—… ê°ì§€
          const jobMap = {
            "ë°ì´í„° ì‚¬ì´ì–¸í‹°ìŠ¤íŠ¸": "ğŸ“Š ë°ì´í„° ì‚¬ì´ì–¸í‹°ìŠ¤íŠ¸",
            "ìŠ¤ë§ˆíŠ¸íŒ©í† ë¦¬":        "âš™ï¸ ìŠ¤ë§ˆíŠ¸íŒ©í† ë¦¬ ì „ë¬¸ê°€",
            "ë””ì§€í„¸ í—¬ìŠ¤ì¼€ì–´":     "ğŸ§¬ ë””ì§€í„¸ í—¬ìŠ¤ì¼€ì–´",
            "ì‹ ì¬ìƒì—ë„ˆì§€":        "â˜€ï¸ ì‹ ì¬ìƒì—ë„ˆì§€ ì—”ì§€ë‹ˆì–´",
            "ìŠ¤ë§ˆíŠ¸ì‹œí‹°":          "ğŸ™ï¸ ìŠ¤ë§ˆíŠ¸ì‹œí‹° ì„¤ê³„",
            "ì‚¬ì´ë²„ë³´ì•ˆ":          "ğŸ›¡ï¸ ì‚¬ì´ë²„ë³´ì•ˆ ì „ë¬¸ê°€",
            "ìš°ì£¼íƒì‚¬":            "ğŸš€ ìš°ì£¼íƒì‚¬ ë¡œë´‡ ì—”ì§€ë‹ˆì–´",
            "ì—…ì‚¬ì´í´":            "â™»ï¸ ì—…ì‚¬ì´í´ ì œí’ˆ ê°œë°œì",
          };
          Object.entries(jobMap).forEach(([keyword, label]) => {
            if (text.includes(keyword)) {
              document.getElementById('job-display').textContent = label;
            }
          });

          // ì„ íƒì§€ â†’ ë²„íŠ¼ ë³€í™˜
          const matches = [...text.matchAll(/[1-3][ï¸âƒ£.)]\s*([^\n]+)/g)];
          if (matches.length >= 2) {
            const emojis = ['1ï¸âƒ£', '2ï¸âƒ£', '3ï¸âƒ£'];
            action = {
              ...action,
              payload: {
                ...action.payload,
                activity: {
                  ...action.payload.activity,
                  suggestedActions: {
                    to: [],
                    actions: matches.slice(0, 3).map((m, i) => ({
                      type:  'imBack',
                      title: `${emojis[i]} ${m[1].trim()}`,
                      value: String(i + 1)
                    }))
                  }
                }
              }
            };
          }
        }
        return next(action);
      };
    }

    // â”â”â” WebChat ì´ˆê¸°í™” â”â”â”
 window.onload = function() {
  document.getElementById('webchat').innerHTML =
    '<iframe src="https://copilotstudio.microsoft.com/environments/Default-62ae463a-9f12-4edf-8544-4f6ca3834524/bots/copilots_header_dc6a3/webchat?__version__=2" frameborder="0" style="width:100%;height:100%;min-height:600px;border:none;"></iframe>';
  renderStats();
};
  </script>
</body>
</html>
